{% extends 'charts/chart_with_form.html' %}
{% block params %}
<form class="form-horizontal">
    <fieldset>
        <div class="form-group">
            <label class="col-md-4 control-label" for="region_selector">Регионы</label>
            <div class="col-md-4">
                <select id='region_selector' data-placeholder="Выберите регион" class="chosen-select form-control" multiple tabindex="6">
                    {% for region in regions %}
                        <option>{{ region.offset|safe }} {{ region.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-4 control-label" for="period">Период</label>
            <div id='period' class="form-horizontal">
                <fieldset>
                    <div class="form-group">
                        <label class="col-md-2 control-label" for="fromYear">С</label>
                        <div class="col-md-4">
                            <select id="fromYear" class="form-control">
                            {% for year in years %}
                                <option value="{{ year }}">{{ year }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 control-label" for="toYear">По</label>
                        <div class="col-md-4">
                            <select id="toYear" class="form-control">
                            {% for year in years %}
                                <option value="{{ year }}">{{ year }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-4 control-label" for="showButton"></label>
            <div class="col-md-4">
                <button id="showButton" class="btn btn-primary ladda-button" data-style="zoom-out" onclick="show()">
                    <span class="ladda-label">Show</span>
                </button>
            </div>
        </div>
    </fieldset>
</form>
{% endblock %}

{% block additional_js %}
    <script type="text/javascript">
        var chart = new google.visualization.Sankey(document.getElementById('chart'));

        function getURL() {
            return "regions/" + getSelectedRegions() + "/from_year/" + $("#fromYear").val() +
                    "/to_year/" + $("#toYear").val();
        }
        function show() {
            var url = getURL();
            startLoadAnimation();
            $.ajax({
                url: url + "/data",
                dataType: "json"
            })
            .success(function(data) {
                var options = {
                    //title: data.chart_title,
                    //width: 900,
                    //sankey: {
                        //    link: { color: { fill: '#d799ae' } },
                        //    node: { color: { fill: '#a61d4c' },
                        //            label: { color: '#871b47' } }
                        //}
                     //sankey: { node: { nodePadding: 80 } }
                        sankey: {
                            node: {
                                    label: {
                                    fontName: 'Times-Roman',
                                     fontSize: 12,
                                     color: '#000',
                                     bold: true,
                                    italic: false
                                    },
                                labelPadding: 6, // Horizontal distance between the label and the node.
                                nodePadding: 10, // Vertical distance between nodes.
                                width: 5         // Thickness of the node.
                            }
                        }
                };
                var data_table = new google.visualization.DataTable();
                data_table.addColumn('string', 'From');
                data_table.addColumn('string', 'To');
                data_table.addColumn('number', 'Weight');
                data_table.addRows(data.chart_data)

                chart.draw(data_table, options);

                $("#url").text(getFullURL(url));
            })
            .fail(function() {
                    alert("Connection with server is lost")
            })
            .always(function() {
                    stopLoadAnimation();
            });
        }
    </script>
{% endblock %}
